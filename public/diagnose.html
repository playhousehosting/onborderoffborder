<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Page</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: #252526;
            border-radius: 5px;
        }
        .error { color: #f48771; }
        .success { color: #89d185; }
        .warning { color: #dcdcaa; }
        h2 { color: #4ec9b0; }
        pre { background: #1e1e1e; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç White Screen Diagnostic Tool</h1>
    
    <div class="section">
        <h2>1. Browser Information</h2>
        <pre id="browserInfo"></pre>
    </div>
    
    <div class="section">
        <h2>2. LocalStorage Check</h2>
        <pre id="localStorageInfo"></pre>
    </div>
    
    <div class="section">
        <h2>3. DOM Check</h2>
        <pre id="domInfo"></pre>
    </div>
    
    <div class="section">
        <h2>4. Console Errors</h2>
        <pre id="consoleErrors">No errors captured yet. Check browser console for real-time errors.</pre>
    </div>
    
    <div class="section">
        <h2>5. Network Status</h2>
        <pre id="networkInfo"></pre>
    </div>

    <div class="section">
        <h2>6. Recommendations</h2>
        <div id="recommendations"></div>
    </div>

    <script>
        // Capture console errors
        const errors = [];
        const originalError = console.error;
        console.error = function(...args) {
            errors.push(args.join(' '));
            originalError.apply(console, args);
            document.getElementById('consoleErrors').innerHTML = 
                errors.length ? '<span class="error">' + errors.join('\n') + '</span>' : 'No errors detected';
        };

        // Browser info
        document.getElementById('browserInfo').innerHTML = `
User Agent: ${navigator.userAgent}
Platform: ${navigator.platform}
Language: ${navigator.language}
Online: <span class="${navigator.onLine ? 'success' : 'error'}">${navigator.onLine}</span>
Cookies Enabled: <span class="${navigator.cookieEnabled ? 'success' : 'error'}">${navigator.cookieEnabled}</span>
        `;

        // LocalStorage check
        try {
            const azureConfig = localStorage.getItem('azureConfig');
            const demoUser = localStorage.getItem('demoUser');
            const demoMode = localStorage.getItem('demoMode');
            
            let storageInfo = '';
            
            if (azureConfig) {
                try {
                    const config = JSON.parse(azureConfig);
                    storageInfo += `<span class="success">‚úì Azure Config Found</span>\n`;
                    storageInfo += `  - Client ID: ${config.clientId ? '‚úì Set' : '‚úó Missing'}\n`;
                    storageInfo += `  - Tenant ID: ${config.tenantId ? '‚úì Set' : '‚úó Missing'}\n`;
                } catch (e) {
                    storageInfo += `<span class="error">‚úó Azure Config is malformed</span>\n`;
                }
            } else {
                storageInfo += `<span class="warning">‚ö† Azure Config NOT found</span>\n`;
            }
            
            if (demoMode === 'true') {
                storageInfo += `<span class="success">‚úì Demo Mode: ENABLED</span>\n`;
            } else {
                storageInfo += `<span class="warning">Demo Mode: disabled</span>\n`;
            }
            
            if (demoUser) {
                storageInfo += `<span class="success">‚úì Demo User: Present</span>\n`;
            }
            
            document.getElementById('localStorageInfo').innerHTML = storageInfo;
        } catch (e) {
            document.getElementById('localStorageInfo').innerHTML = 
                `<span class="error">Error accessing localStorage: ${e.message}</span>`;
        }

        // DOM check
        const rootElement = document.getElementById('root');
        document.getElementById('domInfo').innerHTML = `
Root element exists: <span class="${rootElement ? 'success' : 'error'}">${!!rootElement}</span>
Document ready state: <span class="success">${document.readyState}</span>
Body children count: ${document.body.children.length}
        `;

        // Network info
        document.getElementById('networkInfo').innerHTML = `
Location: ${window.location.href}
Protocol: ${window.location.protocol}
Port: ${window.location.port || 'default'}
        `;

        // Recommendations
        setTimeout(() => {
            const recommendations = [];
            
            if (!localStorage.getItem('azureConfig') && localStorage.getItem('demoMode') !== 'true') {
                recommendations.push('<span class="error">‚ö† Configure Azure AD or enable Demo Mode</span>');
            }
            
            if (!navigator.onLine) {
                recommendations.push('<span class="error">‚ö† No internet connection detected</span>');
            }
            
            if (!navigator.cookieEnabled) {
                recommendations.push('<span class="error">‚ö† Cookies are disabled</span>');
            }
            
            if (errors.length > 0) {
                recommendations.push('<span class="error">‚ö† JavaScript errors detected - check console</span>');
            }
            
            if (recommendations.length === 0) {
                recommendations.push('<span class="success">‚úì No obvious issues detected. Try:</span>');
                recommendations.push('  1. Clear browser cache and hard refresh (Ctrl+Shift+R)');
                recommendations.push('  2. Check browser console (F12) for errors');
                recommendations.push('  3. Verify React app is running on http://localhost:3000');
            }
            
            document.getElementById('recommendations').innerHTML = 
                '<pre>' + recommendations.join('\n') + '</pre>';
        }, 1000);
    </script>
</body>
</html>
